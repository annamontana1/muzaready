generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("TURSO_CONNECTION_URL")
}

model AdminUser {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String
  role      String   @default("editor")
  status    String   @default("active")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("admin_users")
}

model Product {
  id                       String     @id @default(cuid())
  name                     String
  category                 String?
  tier                     String
  base_price_per_100g_45cm Float
  set_id                   String?
  createdAt                DateTime   @default(now())
  updatedAt                DateTime   @updatedAt
  cartItems                CartItem[]
  favorites                Favorite[]
  variants                 Variant[]

  @@map("products")
}

model Variant {
  id        String   @id @default(cuid())
  productId String
  name      String
  price     Float
  createdAt DateTime @default(now())
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("variants")
}

model Order {
  id                String      @id @default(cuid())

  // Customer info
  email             String
  firstName         String
  lastName          String
  phone             String?

  // Delivery address
  streetAddress     String
  city              String
  zipCode           String
  country           String      @default("CZ")

  // Delivery
  deliveryMethod    String      @default("standard") // standard, express, pickup

  // Payment & Status
  status            String      @default("awaiting_payment") // awaiting_payment, paid, processing, assembly_in_progress, shipped, cancelled_unpaid, refunded
  paymentStatus     String      @default("unpaid")      // unpaid, paid, refunded, failed
  paymentMethod     String?     // gopay, bank_transfer, cash

  // Order details
  subtotal          Float
  shippingCost      Float       @default(0)
  discountAmount    Float       @default(0)
  total             Float

  // Tracking
  trackingNumber    String?

  // Timestamps
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  paidAt            DateTime?
  shippedAt         DateTime?

  items             OrderItem[]

  @@map("orders")
}

model OrderItem {
  id               String       @id @default(cuid())
  orderId          String
  assemblyFeeCzk   Int?
  assemblyFeeTotal Int?
  assemblyFeeType  String?
  createdAt        DateTime     @default(now())
  ending           EndingOption @default(NONE)
  grams            Int
  lineTotal        Int
  nameSnapshot     String?
  pricePerGram     Int
  saleMode         SaleMode
  skuId            String
  order            Order        @relation(fields: [orderId], references: [id], onDelete: Cascade)
  sku              Sku          @relation(fields: [skuId], references: [id])

  @@map("order_items")
}

model CartItem {
  id        String   @id @default(cuid())
  sessionId String
  productId String
  quantity  Int
  variant   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([sessionId, productId])
  @@map("cart_items")
}

model Favorite {
  id        String   @id @default(cuid())
  sessionId String
  productId String
  createdAt DateTime @default(now())
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([sessionId, productId])
  @@map("favorites")
}

model Sku {
  id               String            @id @default(cuid())
  sku              String            @unique
  name             String?
  productId        String?
  shade            String?
  shadeName        String?
  shadeHex         String?
  shadeRangeStart  Int?
  shadeRangeEnd    Int?
  lengthCm         Int?
  structure        String?
  ending           String?
  ribbonColor      String?
  saleMode         SaleMode
  pricePerGramCzk  Float?
  pricePerGramEur  Float?
  weightTotalG     Int?
  weightGrams      Int?
  priceCzkTotal    Float?
  priceEurTotal    Float?
  soldOut          Boolean           @default(false)
  availableGrams   Int?
  minOrderG        Int?
  stepG            Int?
  inStock          Boolean           @default(false)
  inStockSince     DateTime?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  customerCategory CustomerCategory?
  isListed         Boolean           @default(false)
  listingPriority  Int?
  reservedUntil    DateTime?
  orderItems       OrderItem[]
  movements        StockMovement[]

  @@map("skus")
}

model StockMovement {
  id         String   @id @default(cuid())
  skuId      String
  type       MoveType
  grams      Int
  note       String?
  refOrderId String?
  createdAt  DateTime @default(now())
  sku        Sku      @relation(fields: [skuId], references: [id], onDelete: Cascade)

  @@map("stock_movements")
}

model PriceMatrix {
  id               String   @id @default(cuid())
  category         String
  tier             String
  shadeRangeStart  Int?
  shadeRangeEnd    Int?
  lengthCm         Int
  pricePerGramCzk  Float
  pricePerGramEur  Float?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@unique([category, tier, shadeRangeStart, shadeRangeEnd, lengthCm])
  @@index([category, tier])
  @@map("price_matrix")
}

enum HairTreatment {
  PANENSKE_NEBARVENE
  BARVENE
}

enum CustomerCategory {
  STANDARD
  LUXE
  PLATINUM_EDITION
}

enum SaleMode {
  PIECE_BY_WEIGHT
  BULK_G
}

enum EndingOption {
  KERATIN
  PASKY
  TRESSY
  NONE
}

enum MoveType {
  IN
  OUT
  ADJUST
}

model ExchangeRate {
  id          String   @id @default(cuid())
  czk_to_eur  Decimal
  description String?
  lastUpdated DateTime @default(now())
  updatedBy   String?

  @@map("exchange_rates")
}

model User {
  id                    String   @id @default(cuid())
  email                 String   @unique
  password              String
  firstName             String
  lastName              String
  phone                 String?

  // Wholesale specific
  wholesaleRequested    Boolean  @default(false)
  isWholesale           Boolean  @default(false)
  wholesaleRequestedAt  DateTime?
  wholesaleApprovedAt   DateTime?

  // Business info (for wholesale users)
  companyName           String?
  businessType          String?  // "salon", "stylist", "distributor"
  website               String?
  instagram             String?
  country               String?
  city                  String?
  zipCode               String?
  streetAddress         String?
  taxId                 String?

  // Status
  status                String   @default("active")  // active, suspended, rejected
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  // Relations
  sessions              Session[]

  @@map("users")
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@map("sessions")
}
